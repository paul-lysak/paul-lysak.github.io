<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.20.7" />




<link rel="canonical" href="http://www.aimplicits.com/posts/2016-09-01-play-scalatest-and-afterall-there-is-no/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>Play, ScalaTest and afterAll: There is no started application - Ambiguous Implicits - Paul Lysak&#39;s blog about programming</title>
    
<meta name="description" content="Recently I was trying to do some cleanup of shared DB after the tests (with ScalaTest) of Play application using afterAll method of BeforeAndAfterAll trait. DB credentials were contained in Play’s config files so cleanup code relied on running play application. But when trying to run the test I’ve got an exception:java.lang.RuntimeException: There is no started application Looks like application was shut down before afterAll gets started. Turns out that traits inclusion order matters here.">

<meta property="og:title" content="Play, ScalaTest and afterAll: There is no started application - Ambiguous Implicits - Paul Lysak&#39;s blog about programming">
<meta property="og:type" content="article">
<meta property="og:url" content="http://www.aimplicits.com/posts/2016-09-01-play-scalatest-and-afterall-there-is-no/">
<meta property="og:image" content="http://www.aimplicits.com/images/default.png">
<meta property="og:site_name" content="Ambiguous Implicits - Paul Lysak&#39;s blog about programming">
<meta property="og:description" content="Recently I was trying to do some cleanup of shared DB after the tests (with ScalaTest) of Play application using afterAll method of BeforeAndAfterAll trait. DB credentials were contained in Play’s config files so cleanup code relied on running play application. But when trying to run the test I’ve got an exception:java.lang.RuntimeException: There is no started application Looks like application was shut down before afterAll gets started. Turns out that traits inclusion order matters here.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Ambiguous Implicits - Paul Lysak&#39;s blog about programming">
<meta name="twitter:url" content="http://www.aimplicits.com/posts/2016-09-01-play-scalatest-and-afterall-there-is-no/">
<meta name="twitter:title" content="Play, ScalaTest and afterAll: There is no started application - Ambiguous Implicits - Paul Lysak&#39;s blog about programming">
<meta name="twitter:description" content="Recently I was trying to do some cleanup of shared DB after the tests (with ScalaTest) of Play application using afterAll method of BeforeAndAfterAll trait. DB credentials were contained in Play’s config files so cleanup code relied on running play application. But when trying to run the test I’ve got an exception:java.lang.RuntimeException: There is no started application Looks like application was shut down before afterAll gets started. Turns out that traits inclusion order matters here.">
<meta name="twitter:image" content="http://www.aimplicits.com/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http://www.aimplicits.com/"
    },
    "headline": "Play, ScalaTest and afterAll: There is no started application - Ambiguous Implicits - Paul Lysak&#39;s blog about programming",
    "image": {
      "@type": "ImageObject",
      "url": "http://www.aimplicits.com/images/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2016-09-01T19:07:00JST",
    "dateModified": "2016-09-01T19:07:00JST",
    "author": {
      "@type": "Person",
      "name": "Ambiguous Implicits - Paul Lysak&#39;s blog about programming"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Ambiguous Implicits - Paul Lysak&#39;s blog about programming",
      "logo": {
        "@type": "ImageObject",
        "url": "http://www.aimplicits.com/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "Recently I was trying to do some cleanup of shared DB after the tests (with ScalaTest) of Play application using afterAll method of BeforeAndAfterAll trait. DB credentials were contained in Play’s config files so cleanup code relied on running play application. But when trying to run the test I’ve got an exception:
java.lang.RuntimeException: There is no started application
 Looks like application was shut down before afterAll gets started. Turns out that traits inclusion order matters here."
  }
</script>


    <link href="http://www.aimplicits.com/css/styles.css" rel="stylesheet">
    <link href="/css/aimplicits.css" rel="stylesheet">
  </head>

  <body>
    
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-98972707-1', 'auto');
ga('send', 'pageview');
</script>

    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://www.aimplicits.com/">Ambiguous Implicits - Paul Lysak&#39;s blog about programming</a>
          </div>

          
          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="https://twitter.com/paul_lysak"><i class='fa fa-twitter'></i></a></li>
              
              
              
              <li><a href="/about/">About</a></li>
              
              
              
              <li><a href="/posts/">Posts</a></li>
              
              
            </ul>
            
          </div>
          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="http://www.aimplicits.com/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://www.aimplicits.com/posts/" itemprop="url"><span itemprop="title">posts</span></a></li>
        
        <li class="active">Play, ScalaTest and afterAll: There is no started application</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2016-09-01T19:07:00JST">Sep 1, 2016</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://www.aimplicits.com/posts/">posts</a></li>
      
    </ul>

    <h1 class="title">Play, ScalaTest and afterAll: There is no started application</h1>
  </header>

  

  <div class="article-body"><p>Recently I was trying to do some cleanup of shared DB after the tests (with ScalaTest) of Play application using <code>afterAll</code> method of <code>BeforeAndAfterAll</code> trait. DB credentials were contained in Play’s config files so cleanup code relied on running play application. But when trying to run the test I’ve got an exception:</p> <pre><code>java.lang.RuntimeException: There is no started application<br /></code></pre> <p>Looks like application was shut down before <code>afterAll</code> gets started. Turns out that traits inclusion order matters here. Following code throws an exception:</p> <pre><code>class MySpec extends PlaySpec <br />             with OneServerPerSuite <br />             with BeforeAndAfterAll {<br />   //tests go here<br />   override def afterAll(): Unit = {<br />       //cleanup code goes here<br />   }<br />}<br /></code></pre> <p>while this works perfectly:</p> <pre><code>class MySpec extends PlaySpec<br />             with BeforeAndAfterAll <br />             with OneServerPerSuite ...<br /></code></pre> <p>Same applies to <code>OneAppPerSuite</code>. The reason is order of overriding <code>SuiteMixin.run()</code> method. <code>BeforeAndAfterAll</code> attaches there handling of <code>beforeAll</code> and <code>afterAll</code> methods, and <code>OneServerPerSuite</code> attaches <code>testServer.start()</code> and <code>testServer.stop()</code>. Didn’t check it, but appears that due to this ordering only one of <code>beforeAll</code> and <code>afterAll</code> can have access to Play application. So, now <code>beforeAll</code> will fail to access application configs.</p>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">TAGS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="http://www.aimplicits.com/tags/play2/">Play2</a></li>
          
          <li><a href="http://www.aimplicits.com/tags/play/">Play</a></li>
          
          <li><a href="http://www.aimplicits.com/tags/scala/">Scala</a></li>
          
          <li><a href="http://www.aimplicits.com/tags/scalatest/">ScalaTest</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">YEARS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="http://www.aimplicits.com/years/2016/">2016</a></li>
          
        </ul>
      </div>
    </section>
    
    
  </footer>

</article>


    
	<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'aimplicits';
    var disqus_identifier = 'http:\/\/www.aimplicits.com\/posts\/2016-09-01-play-scalatest-and-afterall-there-is-no\/';
    var disqus_title = 'Play, ScalaTest and afterAll: There is no started application';
    var disqus_url = 'http:\/\/www.aimplicits.com\/posts\/2016-09-01-play-scalatest-and-afterall-there-is-no\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">




  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title"><a href="http://www.aimplicits.com/years">BY YEAR</a></div>
    </div>
    <div class="list-group">
      
      <a href="http://www.aimplicits.com/years/2017" class="list-group-item">2017</a>
      
      <a href="http://www.aimplicits.com/years/2016" class="list-group-item">2016</a>
      
      <a href="http://www.aimplicits.com/years/2015" class="list-group-item">2015</a>
      
      <a href="http://www.aimplicits.com/years/2014" class="list-group-item">2014</a>
      
      <a href="http://www.aimplicits.com/years/2013" class="list-group-item">2013</a>
      
      <a href="http://www.aimplicits.com/years/2012" class="list-group-item">2012</a>
      
      <a href="http://www.aimplicits.com/years/2011" class="list-group-item">2011</a>
      
    </div>
  </section>


  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title"><a href="http://www.aimplicits.com/tags">TAGS</a></div>
    </div>
    <div class="list-group">
      
      <a href="http://www.aimplicits.com/tags/scala" class="list-group-item">scala</a>
      
      <a href="http://www.aimplicits.com/tags/java" class="list-group-item">java</a>
      
      <a href="http://www.aimplicits.com/tags/play2" class="list-group-item">play2</a>
      
      <a href="http://www.aimplicits.com/tags/play" class="list-group-item">play</a>
      
      <a href="http://www.aimplicits.com/tags/sbt" class="list-group-item">sbt</a>
      
      <a href="http://www.aimplicits.com/tags/spring" class="list-group-item">spring</a>
      
      <a href="http://www.aimplicits.com/tags/javascript" class="list-group-item">javascript</a>
      
      <a href="http://www.aimplicits.com/tags/json" class="list-group-item">json</a>
      
      <a href="http://www.aimplicits.com/tags/integration-test" class="list-group-item">integration-test</a>
      
      <a href="http://www.aimplicits.com/tags/testing" class="list-group-item">testing</a>
      
    </div>
  </section>



</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; Ambiguous Implicits - Paul Lysak&#39;s blog about programming</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

